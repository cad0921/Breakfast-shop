
@{
    ViewBag.Title = "Login";

}
<html lang="zh-Hant" data-theme="light">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>亮亮後台｜登入</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
    :root {
      /* 亮亮 — 日光蛋黃主題 */
      --bg: #fff6d6;        /* 背景米黃 */
      --bg2: #ffeaa3;       /* 次背景淡黃 */
      --card: #fff9e6;      /* 卡片奶油黃 */
      --ink: #6b3d10;       /* 文字深棕橙 */
      --accent: #ffc53d;    /* 主色：蛋黃 */
      --accent-2: #ffb300;  /* 深一階 */
      --accent-3: #fff1b3;  /* 淡一階 */
      --danger: #d9534f;
      --success: #2db47d;
      --muted: #a17937;
      --ring: 0 0 0 .25rem rgba(255,197,61,.35);
    }
    [data-theme="dark"] {
      --bg: #15130e;
      --bg2: #1f1a10;
      --card: #201c12;
      --ink: #f7e7c6;
      --accent: #ffc53d;
      --accent-2: #ffb300;
      --accent-3: #4a3b16;
      --muted: #d2b586;
    }
    html, body { height: 100%; }
    body {
      font-family: 'Noto Sans TC', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji';
      background: radial-gradient(1200px 600px at 20% -10%, var(--bg2), transparent),
                  radial-gradient(1000px 500px at 120% 110%, var(--accent-3), transparent),
                  var(--bg);
      color: var(--ink);
    }
    .logo {
      display: inline-flex; align-items: center; gap: .6rem; color: var(--ink); text-decoration: none;
      font-weight: 900; letter-spacing: .04em; font-size: 1.35rem;
    }
    .logo-mark {
      width: 38px; height: 38px; border-radius: 12px; background: linear-gradient(145deg, var(--accent), var(--accent-2));
      position: relative; box-shadow: 0 10px 25px rgba(255,179,0,.25), inset 0 2px 6px rgba(255,255,255,.35);
    }
    .logo-mark::before { /* 小亮光 */
      content: ""; position: absolute; inset: 4px; border-radius: 10px; background: radial-gradient(20px 14px at 30% 25%, #fff8, transparent);
    }
    .shelf {
      min-height: 100%; display: grid; place-items: center; padding: 2rem;
    }
    .card-login {
      width: 100%; max-width: 440px; background: var(--card); border: 1px solid rgba(0,0,0,.04);
      border-radius: 20px; box-shadow: 0 12px 40px rgba(160, 120, 30, .15);
    }
    .card-login .card-body { padding: 1.5rem; }
    @@media (min-width: 480px) { .card-login .card-body { padding: 2rem; } }

    .title { font-weight: 900; font-size: 1.4rem; letter-spacing: .02em; }
    .subtitle { color: var(--muted); font-size: .95rem; }

    .form-control, .form-select {
      background-color: #fff; border-radius: 14px; border: 1px solid #e7d8b5; color: var(--ink);
    }
    .form-control:focus { border-color: var(--accent-2); box-shadow: var(--ring); }

    .btn-egg {
      --bs-btn-bg: var(--accent);
      --bs-btn-border-color: var(--accent);
      --bs-btn-hover-bg: var(--accent-2);
      --bs-btn-hover-border-color: var(--accent-2);
      --bs-btn-active-bg: var(--accent-2);
      --bs-btn-active-border-color: var(--accent-2);
      --bs-btn-color: #3b2605;
      border-radius: 14px; font-weight: 800; letter-spacing: .02em;
    }
    .btn-outline-ink { border-color: #e7d8b5; color: var(--ink); }
    .btn-outline-ink:hover { background: #fff; border-color: var(--accent-2); box-shadow: var(--ring); }
    .link-ink { color: var(--ink); }
    .link-ink:hover { color: var(--accent-2); }

    .toggle-eye {
      position: absolute; right: .75rem; top: 50%; transform: translateY(-50%);
      border: none; background: transparent; padding: .25rem .35rem; line-height: 1; opacity: .6; transition: opacity .2s;
    }
    .toggle-eye:hover { opacity: 1; }

    .footer-muted { color: var(--muted); font-size: .85rem; }

    .brand-watermark {
      pointer-events: none; position: fixed; inset: auto -16px 6px auto; transform: rotate(-7deg);
      font-weight: 900; font-size: clamp(2.2rem, 7vw, 4.6rem); color: #0001;
    }
    </style>
</head>
<body>
    <main class="shelf">
        <div class="w-100 d-flex justify-content-between align-items-center mb-4" style="max-width: 920px;">
            <a class="logo" href="#" aria-label="返回首頁">
                <span class="logo-mark"></span>
                <span>亮亮 後台</span>
            </a>
            <div class="d-flex align-items-center gap-2">
                <button id="themeToggle" class="btn btn-sm btn-outline-ink" type="button" aria-label="切換明暗">切換主題</button>
            </div>
        </div>

        <div class="card card-login">
            <div class="card-body">
                <div class="mb-3 text-center">
                    <div class="d-inline-flex align-items-center justify-content-center rounded-4 mb-2" style="width:64px;height:64px;background:linear-gradient(145deg,var(--accent-3),#fff);border:1px solid #0001;">
                        <div class="logo-mark" style="width:28px;height:28px;border-radius:9px;box-shadow: none;"></div>
                    </div>
                    <h1 class="title mb-1">登入後台</h1>
                    <p class="subtitle mb-0">歡迎回來，請輸入帳號與密碼</p>
                </div>

                <form id="loginForm" novalidate>
                    <div class="mb-3">
                        <label for="username" class="form-label">帳號</label>
                        <input type="text" class="form-control" id="username" name="username" placeholder="例如：admin" required minlength="3" autocomplete="username" />
                        <div class="invalid-feedback">請輸入至少 3 個字元的帳號。</div>
                    </div>

                    <div class="mb-2 position-relative">
                        <label for="password" class="form-label">密碼</label>
                        <input type="password" class="form-control" id="password" name="password" placeholder="••••••••" required minlength="6" autocomplete="current-password" />
                        <button class="toggle-eye" type="button" aria-label="顯示/隱藏密碼" tabindex="-1" onclick="togglePassword()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-eye">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                        <div class="invalid-feedback">密碼至少 6 碼。</div>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="1" id="rememberMe" />
                            <label class="form-check-label" for="rememberMe">記住我</label>
                        </div>
                        <a class="link-ink" href="#" onclick="toast('請洽系統管理員重設密碼');return false;">忘記密碼？</a>
                    </div>

                    <button id="submitBtn" class="btn btn-egg w-100 py-2" type="submit">
                        <span class="btn-text">登入</span>
                        <span class="spinner-border spinner-border-sm ms-2 d-none" aria-hidden="true"></span>
                    </button>
                </form>

                <div class="alert alert-danger d-none mt-3" id="errorBox" role="alert"></div>
                <div class="alert alert-success d-none mt-3" id="okBox" role="alert"></div>

                <p class="text-center mt-4 mb-0 footer-muted">© <span id="year"></span> 亮亮資訊管理平台</p>
            </div>
        </div>

        <div class="brand-watermark">LIANG LIANG</div>
    </main>

    <script>
        // 年份顯示
        document.getElementById('year').textContent = new Date().getFullYear();

        // 明暗主題切換
        const themeToggleBtn = document.getElementById('themeToggle');
        const savedTheme = localStorage.getItem('ll-theme');
        if (savedTheme) document.documentElement.setAttribute('data-theme', savedTheme);
        themeToggleBtn.addEventListener('click', () => {
            const html = document.documentElement;
            const next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', next);
            localStorage.setItem('ll-theme', next);
        });

        // 顯示/隱藏密碼
        function togglePassword() {
            const input = document.getElementById('password');
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        // 簡單 toast
        function toast(msg) {
            const box = document.getElementById('okBox');
            box.textContent = msg; box.classList.remove('d-none');
            setTimeout(() => box.classList.add('d-none'), 2200);
        }

        // 表單送出（呼叫後端登入 API）
        const loginUrl = '@Url.Action("Login", "Home")';
        const form = document.getElementById('loginForm');
        const submitBtn = document.getElementById('submitBtn');
        const spinner = submitBtn.querySelector('.spinner-border');
        const btnText = submitBtn.querySelector('.btn-text');
        const errorBox = document.getElementById('errorBox');
        const rememberBox = document.getElementById('rememberMe');
        const accountInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');

        const savedAccount = localStorage.getItem('ll-login-account');
        if (savedAccount) {
            accountInput.value = savedAccount;
            rememberBox.checked = true;
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            errorBox.classList.add('d-none');

            if (!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }

            spinner.classList.remove('d-none');
            btnText.textContent = '驗證中…';
            submitBtn.disabled = true;

            const account = accountInput.value.trim();
            const password = passwordInput.value;

            try {
                const payload = new URLSearchParams();
                payload.append('Account', account);
                payload.append('Password', password);

                const resp = await fetch(loginUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: payload
                });

                let data = null;
                try {
                    data = await resp.json();
                } catch (_) {
                    /* ignore json parse error, handle below */
                }

                if (!resp.ok || !data || data.ok !== true) {
                    throw new Error((data && data.error) || '登入失敗');
                }

                sessionStorage.setItem('ll-shop-id', data.id);
                sessionStorage.setItem('ll-shop-name', data.name || '');
                sessionStorage.setItem('ll-shop-account', data.account || '');

                if (rememberBox.checked) {
                    localStorage.setItem('ll-login-account', account);
                } else {
                    localStorage.removeItem('ll-login-account');
                }

                window.location.href = '@Url.Action("Backstage", "Home")';
            } catch (err) {
                errorBox.textContent = err.message || '無法登入';
                errorBox.classList.remove('d-none');
            } finally {
                spinner.classList.add('d-none');
                btnText.textContent = '登入';
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
